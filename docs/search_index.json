[["index.html", "应用非参数统计 背景", " 应用非参数统计 Huang 2021-07-14 背景 开始学习《应用非参数统计》，薛留根，科学出版社。居然没有豆瓣链接。 理论部分大多是手写笔记，这里主要记录一下R语言的的实现。 2021-6-22 "],["binom-test.html", "1 基于二项分布的检验 1.1 主要理论 1.2 习题3", " 1 基于二项分布的检验 1.1 主要理论 二项分布描述了n重Bernoulli试验种恰有k次成功的概率，记为\\(B(n,p)\\)，基于二项分布的检验主要是对\\(p\\)进行检验： \\[ H_0:\\ p=p_0\\qquad v.s. \\qquad H_1:\\ ? \\] 涉及到具体的实际问题主要有： 分位数检验：\\(X\\)的\\(p_0\\)分位数是\\(x_0\\)，数据中没有严格等于\\(x_0\\)的数 符号检验：\\(p_0=0.5\\)的二项检验。可用以中位数检验，两样本中成对数据的比较以及位置参数的检验 涉及到的主要R语言函数：binom.test。 formals(binom.test) #&gt; $x #&gt; #&gt; #&gt; $n #&gt; #&gt; #&gt; $p #&gt; [1] 0.5 #&gt; #&gt; $alternative #&gt; c(&quot;two.sided&quot;, &quot;less&quot;, &quot;greater&quot;) #&gt; #&gt; $conf.level #&gt; [1] 0.95 1.2 习题3 3.1 已知某中昆虫的20%显示出特性A，在非正常的环境下得到18条昆虫，其中没有一条具有特性A。那么假设在这种环境下，此种昆虫和通常环境一样有0.2的概率显示特性A，这合理吗？取显著性水平\\(\\alpha=0.05\\)，用双边检验。 解： 基于二项分布的检验问题： \\[ p=0.2\\qquad v.s.\\qquad p\\ne0.2 \\] 利用R： binom.test(x = 0,n = 18,p = 0.2,alternative = &quot;two.sided&quot;) #&gt; #&gt; Exact binomial test #&gt; #&gt; data: 0 and 18 #&gt; number of successes = 0, number of trials = 18, p-value = 0.03 #&gt; alternative hypothesis: true probability of success is not equal to 0.2 #&gt; 95 percent confidence interval: #&gt; 0.000 0.185 #&gt; sample estimates: #&gt; probability of success #&gt; 0 p值小于0.05，故应当拒绝原假设，即假设在这种环境下，此种昆虫和通常环境一样有0.2的概率显示特性A，这不合理。 3.2 在一次安全月活动中，所检验的16辆车中有6辆是不安全的。试在显著性水平\\(\\alpha=0.05\\)下，检验原假设：这些车中有不多于10%的车是安全的。 解： 设\\(p\\)是车辆不安全的概率，有基于二项分布的检验问题： \\[ p\\le0.1 \\qquad v.s. \\qquad p&gt;0.1 \\] 利用R： binom.test(x = 6,n = 16,p = 0.1,alternative = &quot;greater&quot;) #&gt; #&gt; Exact binomial test #&gt; #&gt; data: 6 and 16 #&gt; number of successes = 6, number of trials = 16, p-value = 0.003 #&gt; alternative hypothesis: true probability of success is greater than 0.1 #&gt; 95 percent confidence interval: #&gt; 0.178 1.000 #&gt; sample estimates: #&gt; probability of success #&gt; 0.375 \\(p\\)值小于0.05，应当拒绝原假设。 3.3 某一居民小区向市政府报告说，至少有60%的居民认同小区改造建设。市政府随后就随机调查了100个居民，其中48人同意这种小区改造建设。问在显著性水平\\(\\alpha=0.05\\)下，检验这个居民小区的报告是否合理。 解： 同意小区改造假设的居民人数服从二项分布，\\(p\\)为同意的概率。检验问题： \\[ p \\ge 0.6 \\qquad v.s. \\qquad p&lt;0.6 \\] 利用R： binom.test(x = 48,n = 100,p = 0.6,alternative = &quot;less&quot;) #&gt; #&gt; Exact binomial test #&gt; #&gt; data: 48 and 100 #&gt; number of successes = 48, number of trials = 100, p-value = 0.01 #&gt; alternative hypothesis: true probability of success is less than 0.6 #&gt; 95 percent confidence interval: #&gt; 0.000 0.567 #&gt; sample estimates: #&gt; probability of success #&gt; 0.48 \\(p\\)值小于0.05，故应当拒绝原假设，即认为这个居民小区的报告不合理。 3.4 据估计，目前做前列腺手术的男性中有一半正遭受某种副作用的影响。为了努力减轻这种副作用的可能性，FDA研究了一种新的手术方法。19例受手术者只有3人有这种不良副作用，由此得出这项新手术方法能有效减轻副作用，这个结论可靠吗？取显著性水平\\(\\alpha=0.05\\)。 解： 有不良副作用的受手术者人数服从二项分布，\\(p\\)为有不良副作用的概率，为了保护原假设，检验问题： \\[ p\\ge0.5\\qquad v.s. \\qquad p&lt;0.5 \\] 利用R： binom.test(x = 3,n = 19,p = 0.5,alternative = &quot;less&quot;) #&gt; #&gt; Exact binomial test #&gt; #&gt; data: 3 and 19 #&gt; number of successes = 3, number of trials = 19, p-value = 0.002 #&gt; alternative hypothesis: true probability of success is less than 0.5 #&gt; 95 percent confidence interval: #&gt; 0.000 0.359 #&gt; sample estimates: #&gt; probability of success #&gt; 0.158 \\(p\\)值小于0.05，即可以认为结论可靠。 3.5 某学校初中三年级学生的体重的随机样本有如下20个数据（单位：kg）： 71, 67, 49, 59.5, 65.5, 51.5, 77, 61, 46.5, 68.5, 43, 59.5, 80.5, 77, 79, 82.5, 40.5, 58.5, 64, 51.5. 试在显著性水平\\(\\alpha=0.05\\)下，检验下面的假设： （1）体重的中位数为51.5； （2）95%分位数至少是75； （3）30%分位数小于等于45。 解： # 先载入数据 data &lt;- c(71, 67, 49, 59.5, 65.5, 51.5, 77, 61, 46.5, 68.5, 43, 59.5, 80.5, 77, 79, 82.5, 40.5, 58.5, 64, 51.5) （1）利用符号检验 x &lt;- 51.5 S1 = sum(data&lt;x) # 小于中位数个数 S2 = sum(data&gt;x) # 大于中位数个数 S0 = sum(data==x) # 等于中位数个数 binom.test(x = S2,n = S1+S2,p = 0.5,alternative = &quot;two.side&quot;) # 去掉S0 #&gt; #&gt; Exact binomial test #&gt; #&gt; data: S2 and S1 + S2 #&gt; number of successes = 14, number of trials = 18, p-value = 0.03 #&gt; alternative hypothesis: true probability of success is not equal to 0.5 #&gt; 95 percent confidence interval: #&gt; 0.524 0.936 #&gt; sample estimates: #&gt; probability of success #&gt; 0.778 \\(p\\)值小于\\(0.05\\)，故应当拒绝假设（1）. （2）原假设等价于95%分位数大于等于75，也即若75是\\(p_0\\)分位数，则\\(p_0\\le0.95\\)。故检验问题为分位数检验： \\[ H_0:\\ p_0\\le0.95\\qquad v.s. \\qquad H_1:\\ p_0&gt;0.95 \\] x &lt;- 75 S1 = sum(data&lt;x) S2 = sum(data&gt;x) S0 = sum(data==x) S0 #&gt; [1] 0 由于没有数据严格等于75，可实用二项检验： binom.test(x = S1,n = S1+S2,p = 0.95,alternative = &quot;greater&quot;) #&gt; #&gt; Exact binomial test #&gt; #&gt; data: S1 and S1 + S2 #&gt; number of successes = 15, number of trials = 20, p-value = 1 #&gt; alternative hypothesis: true probability of success is greater than 0.95 #&gt; 95 percent confidence interval: #&gt; 0.544 1.000 #&gt; sample estimates: #&gt; probability of success #&gt; 0.75 \\(p\\)值很大，可以接受假设（2）. （3）类似于（2），可以得到分位数检验问题： \\[ H_0:\\ p_0\\ge0.3\\qquad v.s. \\qquad H_1:\\ p_0&lt;0.3 \\] x &lt;- 45 S1 = sum(data&lt;x) S2 = sum(data&gt;x) S0 = sum(data==x) S0 #&gt; [1] 0 由于没有数据严格等于45，可实用二项检验： binom.test(x = S1,n = S1+S2,p = 0.3,alternative = &quot;less&quot;) #&gt; #&gt; Exact binomial test #&gt; #&gt; data: S1 and S1 + S2 #&gt; number of successes = 2, number of trials = 20, p-value = 0.04 #&gt; alternative hypothesis: true probability of success is less than 0.3 #&gt; 95 percent confidence interval: #&gt; 0.000 0.283 #&gt; sample estimates: #&gt; probability of success #&gt; 0.1 \\(p\\)值小于\\(0.05\\)，应当拒绝假设（3）. 3.6 大学新生入学后需要参加一个特殊的高中学业考试，多年以来成绩的上四分位数是72.某高中有16名毕业生上了大学，他们参加了考试，得分如下： 70,92,73,60,81,63,92,68, 75,82,76,72,62,58,95,92 认为这16个学生是这所高中上大学的所有学生的一个随机样本。试在显著性水平\\(\\alpha=0.05\\)下，检验上面所给出的分数是来自一个上四分位数为72的总体。 解： 分位数的检验问题。设\\(X\\)为总体，检验问题： \\[ X的75\\%分位数为72\\quad v.s. \\quad X的75\\%分位数不是72 \\] 因为数据中有严格等于72的数据，所以下面考虑手动计算。 # d为数据向量 # q为分位数值 # p为多少分位数 quantile.test &lt;- function(d, q, p, alternative = c(&quot;two.sided&quot;, &quot;less&quot;, &quot;greater&quot;)){ len &lt;- length(d) t1 &lt;- sum(d&lt;=q) # 小于等于分位数值的个数 t2 &lt;- sum(d&lt;q) # 小于分位数值的个数 l &lt;- pbinom(q = t1,size = len,prob = p) r &lt;- pbinom(q = t2,size = len,prob = p,lower.tail = TRUE) PVAL &lt;- switch(alternative, less = l, greater = r, two.sided = 2*min(l,r)) structure(list(p.value = PVAL, alternative = alternative)) } d &lt;- c(70,92,73,60,81,63,92,68, 75,82,76,72,62,58,95,92 ) quantile.test(d,72,0.75,&quot;two.sided&quot;) #&gt; $p.value #&gt; [1] 0.00329 #&gt; #&gt; $alternative #&gt; [1] &quot;two.sided&quot; 由于\\(p\\)值小于0.05，故应当拒绝原假设。 3.7 在某保险种类中，2011年的索赔数额（单位：万元）的随机样本为 23.12, 23.64, 25.26, 27.42, 34.86, 37.98, 47.40, 52.37, 58.42, 63.71, 73.80, 75.06, 93.60, 98.25 已知2010年的索赔数额的中位数为48.32万元，试在显著性水平\\(\\alpha=0.05\\)下，检验2011年的索赔数额的中位数是否比上一年有所变化。 解： 中位数的双边检验问题，利用符号检验。 # 载入数据 d &lt;- c(23.12, 23.64, 25.26, 27.42, 34.86, 37.98, 47.40, 52.37, 58.42, 63.71, 73.80, 75.06, 93.60, 98.25) x &lt;- 48.32 S1 = sum(d&lt;x) S2 = sum(d&gt;x) S0 = sum(d==x) binom.test(x = S1,n = S1+S2,p = 0.5,alternative = &quot;two.sided&quot;) #&gt; #&gt; Exact binomial test #&gt; #&gt; data: S1 and S1 + S2 #&gt; number of successes = 7, number of trials = 14, p-value = 1 #&gt; alternative hypothesis: true probability of success is not equal to 0.5 #&gt; 95 percent confidence interval: #&gt; 0.23 0.77 #&gt; sample estimates: #&gt; probability of success #&gt; 0.5 \\(p\\)值巨大，可以认为原假设成立，即2011年的索赔数额的中位数比上一年没有显著变化。 3.8 一个工人加工某零件的尺寸标准应该是10mm，顺序度量了20个加工后的零件之后，得到如下尺寸： 9.9,8.8,11.3,10.3,10.0,10.5,11.6,9.4,11.9,9.4, 9.5,11.7,12.2,9.6,12.8,9.8,10.7,10.9,11.3,10.7 试在显著性水平\\(\\alpha=0.05\\)下，检验零件尺寸的中位数是否有大于10mm的可能？ 解： 中位数检验问题： \\[ M&gt;10\\qquad v.s. \\qquad M\\le 10 \\] # 载入数据 d &lt;- c(29.9,8.8,11.3,10.3,10.0,10.5,11.6,9.4,11.9,9.4, 9.5,11.7,12.2,9.6,12.8,9.8,10.7,10.9,11.3,10.7) x &lt;- 10 S1 = sum(d&lt;x) S2 = sum(d&gt;x) S0 = sum(d==x) binom.test(x = S1,n = S1+S2,p = 0.5,alternative = &quot;less&quot;) #&gt; #&gt; Exact binomial test #&gt; #&gt; data: S1 and S1 + S2 #&gt; number of successes = 6, number of trials = 19, p-value = 0.08 #&gt; alternative hypothesis: true probability of success is less than 0.5 #&gt; 95 percent confidence interval: #&gt; 0.00 0.53 #&gt; sample estimates: #&gt; probability of success #&gt; 0.316 \\(p\\)值大于0.05，应当接受原假设，即认为零件尺寸的中位数有大于10mm的可能。 3.9 关顾某食品店的22名顾客品尝甲和乙两种点心并选出喜欢的品种。7名顾客喜欢甲品种，12顾客喜欢乙品种，3名顾客没有特别偏好。问在显著性水平\\(\\alpha=0.05\\)下，这能否说明顾客有明显偏好？ 解： 成对数据的比较，利用两样本的符号检验： \\[ 顾客没有明显偏好\\qquad v.s. \\qquad 顾客没有明显偏好 \\] S1 = 7 # 喜欢甲品种 S2 = 12 # 喜欢乙品种 S0 = 3 # 结点，不考虑 binom.test(x = S1,n = S1+S2,p = 0.5,alternative = &quot;two.sided&quot;) #&gt; #&gt; Exact binomial test #&gt; #&gt; data: S1 and S1 + S2 #&gt; number of successes = 7, number of trials = 19, p-value = 0.4 #&gt; alternative hypothesis: true probability of success is not equal to 0.5 #&gt; 95 percent confidence interval: #&gt; 0.163 0.616 #&gt; sample estimates: #&gt; probability of success #&gt; 0.368 \\(p\\)值大于0.05，故应当接受原假设，即认为顾客有明显偏好。 3.10 某6位学生打算通过节食减肥，节食前后的体重（单位：kg）有如下结果： 节食前体重：114,121,128,122,141,128 节食后体重：105,126,123,118,143,121 问在显著性水平\\(\\alpha=0.05\\)下，我们能否认为他们的减肥计划是成功的？ 解： 成对数据的比较问题： \\[ P^{-}&gt; P^{+}\\qquad v.s. \\qquad P^{-}\\le P^{+} \\] 即 \\[ P^{-}&gt; 0.5\\qquad v.s. \\qquad P^{-}\\le 0.5 \\] # 载入数据 d1 &lt;- c(114,121,128,122,141,128) d2 &lt;- c(105,126,123,118,143,121) S1 &lt;- sum(d2&lt;d1) # S- S2 &lt;- sum(d2&gt;d1) # S+ binom.test(x = S1,n = S1+S2,p = 0.5,alternative = &quot;less&quot;) #&gt; #&gt; Exact binomial test #&gt; #&gt; data: S1 and S1 + S2 #&gt; number of successes = 4, number of trials = 6, p-value = 0.9 #&gt; alternative hypothesis: true probability of success is less than 0.5 #&gt; 95 percent confidence interval: #&gt; 0.000 0.937 #&gt; sample estimates: #&gt; probability of success #&gt; 0.667 \\(p\\)值大于0.05，故我们应当接受原假设，即认为他们的减肥计划并不成功。 "],["chisq-test.html", "2 列联分析 2.1 主要理论 2.2 习题4", " 2 列联分析 2.1 主要理论 对于二维列联表： 拟合优度检验：样本是从总体的不同类别中分别抽取，研究不同类别的目标量之间是否存在显著性差异。 独立性检验：两个变量间是否存在联系。 两者都是利用Pearson \\(\\chi^2\\)统计量，在R中使用函数chisq.test。 chisq.test(x, y = NULL, correct = TRUE, p = rep(1/length(x), length(x)), rescale.p = FALSE, simulate.p.value = FALSE, B = 2000) 用法参考：https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/chisq.test 。主要用法为将列联表矩阵赋予参数x。 使用注意： 要求样本量必须足够大，特别是每个单元中的期望频数不能过小。一般需要满足两个准则： 如果只有两个单元，每个单元的期望频数必须大于等于5.在2x2列联表中，有一个期望值小于5且样本量小于40，或几个期望值小于5，或有一个期望值小于1，均不宜作\\(\\chi^2\\)检验。 有两个以上的单元，20%的单元期望频数小于5，不能应用\\(\\chi^2\\)检验。 对于三维列联表： 独立性检验：建立对数线性模型。 利用MASS包的loglin()函数，用法详见：https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loglin 。主要用法为： # a为一个三维数组 loglin(a,list(1,2,3)) # 检验X Y Z独立性 loglin(a,list(1,c(2,3))) # 检验X与（Y Z）独立性 loglin(a,list(c(1,2),c(1,3))) # 检验(X Y)(X Z)独立性，即给定X检验Y Z独立性 并且可以计算Pearson统计量以及LRT统计量，当值较大时拒绝原假设（独立）。 2.2 习题4 4.1 从两台机器生产的产品中随机抽样，来检查两台机器生产的产品次品率是否有差异，列联表如下： 次品 正品 合计 机器1 12 88 100 机器2 16 74 90 合计 28 162 190 试在显著性水平\\(\\alpha=0.05\\)下，检验两台机器生产的产品次品率是否有差异？ 解： 二维列联表的拟合优度检验。 x &lt;- c(12,88,16,74) x &lt;- matrix(x,2,2,byrow = TRUE) chisq.test(x) #&gt; #&gt; Pearson&#39;s Chi-squared test with Yates&#39; continuity correction #&gt; #&gt; data: x #&gt; X-squared = 0.8, df = 1, p-value = 0.4 \\(p\\)值大于0.05，应当接受原假设，即认为两台机器生产的产品次品率没有差异。 4.2 赞成该方案 反对该方案 合计 一分公司 68 32 100 二分公司 75 45 120 三分公司 57 33 90 四分公司 79 31 100 合计 279 141 420 试在显著性水平\\(\\alpha=0.1\\)下，检验四个分公司对改革方案的赞成比例是否一致。 解： 二维列联表的拟合优度检验。 x &lt;- c(68,75,57,79,32,45,33,31) x &lt;- matrix(x,4,2) chisq.test(x) #&gt; #&gt; Pearson&#39;s Chi-squared test #&gt; #&gt; data: x #&gt; X-squared = 3, df = 3, p-value = 0.4 \\(p\\)值大于0.1，应当接受原假设，即认为四个分公司对改革方案的赞成比例一致。 4.3 小于等于30（岁） 31-50（岁） &gt;50（岁） 合计 体育类 83 91 41 215 电视剧类 70 86 38 194 综艺类 45 15 10 70 合计 198 192 89 479 试在显著性水平\\(\\alpha=0.05\\)下，检验不同观众对三类节目的关注率是否一样。 解： 二维列联表的拟合优度检验。 x &lt;- c(83,70,45,91,86,15,41,38,10) x &lt;- matrix(x,3,3) chisq.test(x) #&gt; #&gt; Pearson&#39;s Chi-squared test #&gt; #&gt; data: x #&gt; X-squared = 19, df = 4, p-value = 9e-04 \\(p\\)值小于0.05，应当拒绝原假设，即认为不同观众对三类节目的关注率不一样。 4.4 得肺癌 未得肺癌 合计 抽烟 8 19 27 未抽烟 1 17 18 合计 9 36 45 试在显著性水平\\(\\alpha=0.05\\)下，检验抽烟对得肺癌是否有显著影响。 解： 利用\\(\\chi^2\\)检验，一时间分不清是拟合优度检验还是独立性检验。。 先进行\\(\\chi^2\\)分布的期望值准则验证。 # 输入二维列联表矩阵 # 返回值： # n 总和 # expectation 期望频数矩阵 # rule 是否满足准则 chisq.expectation &lt;- function(x){ res &lt;- list() r &lt;- nrow(x) c &lt;- ncol(x) rs &lt;- apply(x,1,sum) # 每行求和 cs &lt;- apply(x,2,sum) # 每列求和 as &lt;- sum(x) # 总和 res$n &lt;- as res$expectation &lt;- rs%*%t(cs)/as # 期望频数矩阵 if(r==2&amp;c==1|r==1&amp;c==2){ res$rule &lt;- !sum(res$expectation&lt;5) }else if(r==2&amp;c==2){ if(sum(res$expectation&lt;5)==1&amp;as&lt;40){res$rule &lt;-FALSE} else if(sum(res$expectation&lt;5)&gt;1|sum(res$expectation&lt;1)&gt;0) {res$rule &lt;-FALSE} else {res$rule &lt;-TRUE} }else{ res$rule &lt;- (mean(res$expectation&lt;5)&lt;0.2) } res } chisq.expectation(x) #&gt; $n #&gt; [1] 479 #&gt; #&gt; $expectation #&gt; [,1] [,2] [,3] #&gt; [1,] 88.9 86.2 39.9 #&gt; [2,] 80.2 77.8 36.0 #&gt; [3,] 28.9 28.1 13.0 #&gt; #&gt; $rule #&gt; [1] TRUE 满足准则。 x &lt;- c(8,1,19,17) x &lt;- matrix(x,2,2) chisq.test(x) #&gt; Warning in chisq.test(x): Chi-squared approximation may be incorrect #&gt; #&gt; Pearson&#39;s Chi-squared test with Yates&#39; continuity correction #&gt; #&gt; data: x #&gt; X-squared = 3, df = 1, p-value = 0.1 \\(p\\)值大于0.05，应当接受原假设，即认为抽烟对得肺癌没有显著影响。 4.5 肝炎 肝硬化 对照（非肝病患者） 合计 O型 98 38 289 425 A型 67 41 262 370 B型 13 8 57 78 AB型 18 12 30 60 合计 196 99 638 933 试在显著性水平\\(\\alpha=0.05\\)下，检验血型与肝病之间是否存在关联。 解： 先进行\\(\\chi^2\\)分布的期望值准则检验。 x &lt;- c(98,67,13,18,38,41,8,12,289,262,57,30) x &lt;- matrix(x,4,3) x #&gt; [,1] [,2] [,3] #&gt; [1,] 98 38 289 #&gt; [2,] 67 41 262 #&gt; [3,] 13 8 57 #&gt; [4,] 18 12 30 chisq.expectation(x) #&gt; $n #&gt; [1] 933 #&gt; #&gt; $expectation #&gt; [,1] [,2] [,3] #&gt; [1,] 89.3 45.10 290.6 #&gt; [2,] 77.7 39.26 253.0 #&gt; [3,] 16.4 8.28 53.3 #&gt; [4,] 12.6 6.37 41.0 #&gt; #&gt; $rule #&gt; [1] TRUE 满足准则，进行独立性检验。 chisq.test(x) #&gt; #&gt; Pearson&#39;s Chi-squared test #&gt; #&gt; data: x #&gt; X-squared = 15, df = 6, p-value = 0.02 \\(p\\)值小于0.05，应当拒绝原假设，即认为血型与肝病之间存在关联。 4.6 A、B、C是候选学生，列联表展示了各学院投票情况： A B C 合计 一学院 24 23 12 59 二学院 24 14 10 48 三学院 17 8 13 38 四学院 27 19 9 55 合计 92 64 44 200 问在显著性水平\\(\\alpha=0.01\\)下，我们能否认为投票结果与投票者在什么学院相互独立？ 解： 先进行\\(\\chi^2\\)分布的期望值准则检验。 x &lt;- c(24,24,17,27,23,14,8,19,12,10,13,9) x &lt;- matrix(x,4,3) chisq.expectation(x) #&gt; $n #&gt; [1] 200 #&gt; #&gt; $expectation #&gt; [,1] [,2] [,3] #&gt; [1,] 27.1 18.9 12.98 #&gt; [2,] 22.1 15.4 10.56 #&gt; [3,] 17.5 12.2 8.36 #&gt; [4,] 25.3 17.6 12.10 #&gt; #&gt; $rule #&gt; [1] TRUE 满足准则，下面进行独立性检验： chisq.test(x) #&gt; #&gt; Pearson&#39;s Chi-squared test #&gt; #&gt; data: x #&gt; X-squared = 7, df = 6, p-value = 0.4 \\(p\\)值大于0.05，应当接受原假设，即认为投票结果与投票者在什么学院相互独立。 4.7 2x2x2列联表，三个变量分别为护士衣着颜色（X）、儿童性别（Y）、护士性别（Z）。 护士性别 女： 护士衣着颜色/儿童性别 女 男 花衣 36 8 白衣 12 4 护士性别 男： 护士衣着颜色/儿童性别 女 男 花衣 25 13 白衣 1 0 试在显著性水平\\(\\alpha=0.01\\)下，检验这三个变量之间哪些是独立的，哪些是不独立的。 解： 三维列联表的独立性检验： x &lt;- c(36,12,8,4,25,1,13,0) x &lt;- array(x,c(2,2,2)) # 转为三维数组 loglin(x,list(1,2,3)) #&gt; 2 iterations: deviation 1.42e-14 #&gt; $lrt #&gt; [1] 15.3 #&gt; #&gt; $pearson #&gt; [1] 12.6 #&gt; #&gt; $df #&gt; [1] 4 #&gt; #&gt; $margin #&gt; $margin[[1]] #&gt; [1] 1 #&gt; #&gt; $margin[[2]] #&gt; [1] 2 #&gt; #&gt; $margin[[3]] #&gt; [1] 3 library(tidyverse) #&gt; -- Attaching packages ------------------ #&gt;  ggplot2 3.3.2  purrr 0.3.4 #&gt;  tibble 3.0.3  dplyr 1.0.2 #&gt;  tidyr 1.1.1  stringr 1.4.0 #&gt;  readr 1.3.1  forcats 0.5.0 #&gt; -- Conflicts -- tidyverse_conflicts() -- #&gt; x dplyr::filter() masks stats::filter() #&gt; x dplyr::lag() masks stats::lag() iterfun &lt;- function(l){ x &lt;- c(36,12,8,4,25,1,13,0) x &lt;- array(x,c(2,2,2)) loglin(x,margin = l,print = FALSE)[1:3] } models &lt;- list(list(1,2,3),list(1,c(2,3)),list(2,c(1,3)),list(3,c(1,2)), list(c(1,2),c(1,3)),list(c(2,1),c(2,3)),list(c(1,3),c(2,3))) models_name &lt;- c(&quot;(X,Y,Z)&quot;,&quot;(X,YZ)&quot;,&quot;(Y,XZ)&quot;,&quot;(Z,XY)&quot;,&quot;(XY,XZ)&quot;,&quot;(XY,YZ)&quot;,&quot;(XZ,YZ)&quot;) df &lt;- map(models,iterfun) %&gt;% # 对所有模型应用loglin函数 unlist() %&gt;% matrix(ncol = 3,byrow = TRUE) %&gt;% as_tibble() %&gt;% # 转为tibble rename(lrt=V1,pearson=V2,df=V3) %&gt;% # 重命名 mutate(models=models_name) %&gt;% # 加入对应模型名称 select(models,everything()) %&gt;% # 调整列顺序 mutate(cv = qchisq(1-0.01,df)) %&gt;% # 计算显著性水平为0.01的临界值 mutate(lrt_test=(lrt&gt;cv),pearson_test=(pearson&gt;cv)) # 检验结果，是否接受原假设 #&gt; Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0. #&gt; Using compatibility `.name_repair`. #&gt; This warning is displayed once every 8 hours. #&gt; Call `lifecycle::last_warnings()` to see where this warning was generated. knitr::kable(df,digits = 3) models lrt pearson df cv lrt_test pearson_test (X,Y,Z) 15.26 12.638 4 13.28 TRUE FALSE (X,YZ) 13.06 10.213 3 11.35 TRUE FALSE (Y,XZ) 3.35 3.119 3 11.35 FALSE FALSE (Z,XY) 15.22 12.594 3 11.35 TRUE TRUE (XY,XZ) 3.31 3.077 2 9.21 FALSE FALSE (XY,YZ) 13.03 10.370 2 9.21 TRUE TRUE (XZ,YZ) 1.15 0.854 2 9.21 FALSE FALSE 其中lrt_test,pearson_test表示lrt统计量跟pearson统计量的检验结果是否接受原假设（变量独立），可以看到两者有时并非一致的。 4.8 2x2x3列联表，三个变量分别为近视与否（X）、学生性别（Y）、学校（Z）。 学校 甲： 近视与否/学生性别 男 女 近视 55 58 不近视 45 41 学校 乙： 近视与否/学生性别 男 女 近视 66 85 不近视 87 70 学校 丙： 近视与否/学生性别 男 女 近视 66 50 不近视 41 39 试在显著性水平\\(\\alpha=0.01\\)下检验哪些变量独立，哪些不独立。 解： 仿照上一题做法。 library(tidyverse) iterfun &lt;- function(l){ x &lt;- c(55,45,58,41,66,87,85,70,66,41,50,39) x &lt;- array(x,c(2,2,3)) loglin(x,margin = l,print = FALSE)[1:3] } models &lt;- list(list(1,2,3),list(1,c(2,3)),list(2,c(1,3)),list(3,c(1,2)), list(c(1,2),c(1,3)),list(c(2,1),c(2,3)),list(c(1,3),c(2,3))) models_name &lt;- c(&quot;(X,Y,Z)&quot;,&quot;(X,YZ)&quot;,&quot;(Y,XZ)&quot;,&quot;(Z,XY)&quot;,&quot;(XY,XZ)&quot;,&quot;(XY,YZ)&quot;,&quot;(XZ,YZ)&quot;) df &lt;- map(models,iterfun) %&gt;% # 对所有模型应用loglin函数 unlist() %&gt;% matrix(ncol = 3,byrow = TRUE) %&gt;% as_tibble() %&gt;% # 转为tibble rename(lrt=V1,pearson=V2,df=V3) %&gt;% # 重命名 mutate(models=models_name) %&gt;% # 加入对应模型名称 select(models,everything()) %&gt;% # 调整列顺序 mutate(cv = qchisq(1-0.01,df)) %&gt;% # 计算显著性水平为0.01的临界值 mutate(lrt_test=(lrt&gt;cv),pearson_test=(pearson&gt;cv)) # 检验结果，是否接受原假设 knitr::kable(df,digits = 3) models lrt pearson df cv lrt_test pearson_test (X,Y,Z) 12.18 12.12 7 18.5 FALSE FALSE (X,YZ) 10.91 10.90 5 15.1 FALSE FALSE (Y,XZ) 6.36 6.35 5 15.1 FALSE FALSE (Z,XY) 10.85 10.93 6 16.8 FALSE FALSE (XY,XZ) 5.04 5.03 4 13.3 FALSE FALSE (XY,YZ) 9.59 9.54 4 13.3 FALSE FALSE (XZ,YZ) 5.10 5.09 3 11.3 FALSE FALSE 好像…所有变量组合都不独立… "]]
